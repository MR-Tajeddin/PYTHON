import smtplib, ssl, socket
from email.mime.text import MIMEText
from email.mime.multipart import MIMEMultipart
import pandas as pd

sender_email = "nezarat@enamad.ir"  # Enter your address

# read an excel file and convert
# into a dataframe object
df = pd.DataFrame(pd.read_excel("email.xlsx"))
# show the dataframe
receiver_email = df["Addresses"]
#receiver_email = ["mr.tajeddin@gmail.com"]  # Enter receiver address
password = "Nn$123456"

HOST = "mail.enamad.ir"
PORT = 56

HOST = socket.getaddrinfo(HOST, PORT)[0][4][0]
print(HOST)

mail = smtplib.SMTP('mail.enamad.ir',465)
mail.starttls()
mail.login(sender_email, password)
for i in range(len(receiver_email)):

    message = MIMEMultipart("alternative")
    message["Subject"] = "هشدار- رد صلاحیت فردی (اماکن)  "
    message["From"] = "eNAMAD <nezarat@enamad.ir>"
    message["To"] = receiver_email[i]
    html = """\
    <html>
        <body>
        <h3 dir="rtl">
      صاحب امتیاز محترم کسب و کار
</h3>
<p dir="rtl" style="font-size:16px">
باسلام،
</p>
<p dir="rtl" style="font-size:16px">
به اطلاع می‌رساند، به دلیل ردصلاحیت فردی شما توسط پلیس اماکن، نماد اعتماد الکترونیکی کسب وکار شما تعلیق و متعاقبا خدمات درگاه پرداخت بانکی به استناد تبصره 2 ماده 103 آیین نامه اجرایی ماده 14 الحاقی قانون مبارزه با پولشویی نیز متوقف خواهد شد.
خواهشمند است جهت پیگیری موضوع، به اداره اماکن عمومی ناجا محل سکونت خود مراجعه نمایید.
 eNAMAD.ir
 </p>
<p dir="rtl" style="font-size:16px">
توجه نمایید: برای مشاهده نوع و عنوان تخلف (مغایرت) اعلام شده لازم است به پنل کاربری، بخش (تخلف) مراجعه نمایید.
</p>
<p dir="rtl" style="font-size:16px">
برای درخواست رفع تعلیق، با مراجعه به پنل کاربری، یک تیکت با عنوان درخواست رفع تعلیق ثبت نمایید.
</p>
<p>
<a href="https://enamad.ir/"> https://enamad.ir/ </a>
: نماد اعتماد الکترونیکی
</p>

       </body>
     </html>
    """

    # Turn these into plain/html MIMEText objects
    part2 = MIMEText(html, "html")
    print(receiver_email[i])

    # Add HTML/plain-text parts to MIMEMultipart message
    # The email client will try to render the last part first
    message.attach(part2)
    mail.sendmail(sender_email, receiver_email[i], message.as_string())
